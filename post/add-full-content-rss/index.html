<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-cn" lang="zh-cn">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.53" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>给博客添加了全文 RSS &middot; Lifelong Hacker</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="http://blog.jiayuanzhang.comcss/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="http://blog.jiayuanzhang.comcss/poole.css">
  <link type="text/css" rel="stylesheet" href="http://blog.jiayuanzhang.comcss/syntax.css">
  <link type="text/css" rel="stylesheet" href="http://blog.jiayuanzhang.comcss/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="http://blog.jiayuanzhang.com"><h1>Lifelong Hacker</h1></a>
      <p class="lead">
       Working at iqiyi.com, full-stack developer and lifelong hacker. I have a cat named lambda. 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="http://blog.jiayuanzhang.com">Home</a> </li>
        <li><a href="/categories/"> Categories </a></li><li><a href="/post/"> Archives </a></li><li><a href="http://jiayuanzhang.com"> About </a></li>
      </ul>
    </nav>

    <p>&copy; 2019. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>给博客添加了全文 RSS</h1>
  <time datetime=2019-07-24T21:59:00&#43;0800 class="post-date">Wed, Jul 24, 2019</time>
  <p>之前博客虽然也有 RSS，但是不是全文索引的，为了方便读者能够直接在 RSS 阅读器中阅读，花了点时间给博客添加了全文 RSS 输出。</p>

<p>查阅文档<sup class="footnote-ref" id="fnref:fn-1"><a href="#fn:fn-1">1</a></sup>可知，Hugo 的 RSS 模板搜索顺序如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-nil" data-lang="nil">[layouts/index.rss.xml
layouts/home.rss.xml
layouts/rss.xml
layouts/list.rss.xml
layouts/index.xml
layouts/home.xml
layouts/list.xml
layouts/_default/index.rss.xml
layouts/_default/home.rss.xml
layouts/_default/rss.xml
layouts/_default/list.rss.xml
layouts/_default/index.xml
layouts/_default/home.xml
layouts/_default/list.xml
layouts/_internal/_default/rss.xml]</code></pre></div>
<p>我们随便按照顺序建立一个 xml 模板文件即可，例如，我们这里建立
<code>layouts/index.rss.xml</code> 文件，使用 Hugo 官方提供的 RSS 模板：</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">{{ printf &#34;<span class="cp">&lt;?xml version=\&#34;1.0\&#34; encoding=\&#34;utf-8\&#34; standalone=\&#34;yes\&#34; ?&gt;</span>&#34; | safeHTML }}
<span class="p">&lt;</span><span class="nt">rss</span> <span class="na">version</span><span class="o">=</span><span class="s">&#34;2.0&#34;</span> <span class="na">xmlns:atom</span><span class="o">=</span><span class="s">&#34;http://www.w3.org/2005/Atom&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">channel</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{{ if eq  .Title  .Site.Title }}{{ .Site.Title }}{{ else }}{{ with .Title }}{{.}} on {{ end }}{{ .Site.Title }}{{ end }}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span><span class="p">&gt;</span>{{ .Permalink }}<span class="p">&lt;/</span><span class="nt">link</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">description</span><span class="p">&gt;</span>Recent content {{ if ne  .Title  .Site.Title }}{{ with .Title }}in {{.}} {{ end }}{{ end }}on {{ .Site.Title }}<span class="p">&lt;/</span><span class="nt">description</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">generator</span><span class="p">&gt;</span>Hugo -- gohugo.io<span class="p">&lt;/</span><span class="nt">generator</span><span class="p">&gt;</span>{{ with .Site.LanguageCode }}
    <span class="p">&lt;</span><span class="nt">language</span><span class="p">&gt;</span>{{.}}<span class="p">&lt;/</span><span class="nt">language</span><span class="p">&gt;</span>{{end}}{{ with .Site.Author.email }}
    <span class="p">&lt;</span><span class="nt">managingEditor</span><span class="p">&gt;</span>{{.}}{{ with $.Site.Author.name }} ({{.}}){{end}}<span class="p">&lt;/</span><span class="nt">managingEditor</span><span class="p">&gt;</span>{{end}}{{ with .Site.Author.email }}
    <span class="p">&lt;</span><span class="nt">webMaster</span><span class="p">&gt;</span>{{.}}{{ with $.Site.Author.name }} ({{.}}){{end}}<span class="p">&lt;/</span><span class="nt">webMaster</span><span class="p">&gt;</span>{{end}}{{ with .Site.Copyright }}
    <span class="p">&lt;</span><span class="nt">copyright</span><span class="p">&gt;</span>{{.}}<span class="p">&lt;/</span><span class="nt">copyright</span><span class="p">&gt;</span>{{end}}{{ if not .Date.IsZero }}
    <span class="p">&lt;</span><span class="nt">lastBuildDate</span><span class="p">&gt;</span>{{ .Date.Format &#34;Mon, 02 Jan 2006 15:04:05 -0700&#34; | safeHTML }}<span class="p">&lt;/</span><span class="nt">lastBuildDate</span><span class="p">&gt;</span>{{ end }}
    {{ with .OutputFormats.Get &#34;RSS&#34; }}
        {{ printf &#34;<span class="p">&lt;</span><span class="nt">atom:link</span> <span class="na">href</span><span class="o">=</span><span class="s">%q</span> <span class="na">rel</span><span class="o">=</span><span class="s">\&#34;self\&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">%q</span> <span class="p">/&gt;</span>&#34; .Permalink .MediaType | safeHTML }}
    {{ end }}
    {{ range .Pages }}
    <span class="p">&lt;</span><span class="nt">item</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{{ .Title }}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">link</span><span class="p">&gt;</span>{{ .Permalink }}<span class="p">&lt;/</span><span class="nt">link</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">pubDate</span><span class="p">&gt;</span>{{ .Date.Format &#34;Mon, 02 Jan 2006 15:04:05 -0700&#34; | safeHTML }}<span class="p">&lt;/</span><span class="nt">pubDate</span><span class="p">&gt;</span>
      {{ with .Site.Author.email }}<span class="p">&lt;</span><span class="nt">author</span><span class="p">&gt;</span>{{.}}{{ with $.Site.Author.name }} ({{.}}){{end}}<span class="p">&lt;/</span><span class="nt">author</span><span class="p">&gt;</span>{{end}}
      <span class="p">&lt;</span><span class="nt">guid</span><span class="p">&gt;</span>{{ .Permalink }}<span class="p">&lt;/</span><span class="nt">guid</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">description</span><span class="p">&gt;</span>{{ .Summary | html }}<span class="p">&lt;/</span><span class="nt">description</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">item</span><span class="p">&gt;</span>
    {{ end }}
  <span class="p">&lt;/</span><span class="nt">channel</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">rss</span><span class="p">&gt;</span></code></pre></div>
<p>其中，我们需要全局输出，只需要修改 <code>&lt;description&gt;{{ .Summary | html
}}&lt;/description&gt;</code> 为 <code>&lt;description&gt;{{ .Content | html }}&lt;/description&gt;</code> 即可。</p>

<p><code>config.toml</code> 配置中的一些字段可以用来控制 RSS 的输出：</p>
<div class="highlight"><pre class="chroma"><code class="language-toml" data-lang="toml"><span class="nx">rssLimit</span> <span class="p">=</span> <span class="mi">10</span>  <span class="c"># 限制 RSS 文章输出的数量</span>
<span class="nx">languageCode</span> <span class="p">=</span> <span class="s2">&#34;en-us&#34;</span>
<span class="nx">copyright</span> <span class="p">=</span> <span class="s2">&#34;This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.&#34;</span>

<span class="p">[</span><span class="nx">author</span><span class="p">]</span>
    <span class="nx">name</span> <span class="p">=</span> <span class="s2">&#34;My Name Here&#34;</span></code></pre></div>
<p>最开始的时候生成 RSS 会抛出一些异常：</p>
<div class="highlight"><pre class="chroma"><code class="language-language" data-lang="language"> error on line 455 at column 40: PCDATA invalid Char value 8</code></pre></div>
<p>一般来说，出现这些问题是因为 Markdown 文件中存在一些特殊字符，例如 <code>^H</code>、<code>^E</code> 等字符，解决办法有两个：</p>

<ol>
<li>通过 Hugo 的正则表达式替换掉特殊字符，参考文档<sup class="footnote-ref" id="fnref:fn-2"><a href="#fn:fn-2">2</a></sup></li>
<li>在 markdown 源文件中把特殊字符删除</li>
</ol>

<p>另外，可以通过这个链接来订阅本博客：<a href="http://blog.jiayuanzhang.com/index.xml">http://blog.jiayuanzhang.com/index.xml</a></p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:fn-1"><a href="https://gohugo.io/templates/rss/">https://gohugo.io/templates/rss/</a>
 <a class="footnote-return" href="#fnref:fn-1"><sup>[return]</sup></a></li>
<li id="fn:fn-2"><a href="https://gohugo.io/functions/replacere/#readout">https://gohugo.io/functions/replacere/#readout</a>
 <a class="footnote-return" href="#fnref:fn-2"><sup>[return]</sup></a></li>
</ol>
</div>
</div>

<h2>Comments</h2>
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "tisogasnotes" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-130256365-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </body>
</html>

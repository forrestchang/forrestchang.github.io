<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.53" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>给博客添加了全文 RSS &middot; Lifelong Hacker</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="http://blog.jiayuanzhang.com/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="http://blog.jiayuanzhang.com/css/poole.css">
  <link type="text/css" rel="stylesheet" href="http://blog.jiayuanzhang.com/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="http://blog.jiayuanzhang.com/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
</head>

  <body class="theme-base-0c ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="http://blog.jiayuanzhang.com"><h1>Lifelong Hacker</h1></a>
      <p class="lead">
       I&#39;m Jiayuan, a full-stack developer at iqiyi.com. I have a cat named lambda. 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="http://blog.jiayuanzhang.com">Home</a> </li>
        <li><a href="/tags/"> Tags </a></li><li><a href="/post/"> Archives </a></li><li><a href="http://jiayuanzhang.com"> About </a></li>
      </ul>
    </nav>

    <p>&copy; 2019. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>给博客添加了全文 RSS</h1>
  <div class="post-meta post-date">
    <time style="display: inline-block" datetime=2019-07-24T21:59:00&#43;0800> 2019-07-24 </time>
    
    <div class="tags" style="display: inline-block; margin-left: 10px">
      
      <a style="margin-left: 5px" href="http://blog.jiayuanzhang.com/tags/blog">#blog</a>
      
      <a style="margin-left: 5px" href="http://blog.jiayuanzhang.com/tags/hugo">#hugo</a>
      
    </div>
    
  </div>
  <div class="post-content" style="margin-top: 20px">
    <p>之前博客虽然也有 RSS，但是不是全文索引的，为了方便读者能够直接在 RSS 阅读器中阅读，花了点时间给博客添加了全文 RSS 输出。</p>

<p>查阅文档<sup class="footnote-ref" id="fnref:fn-1"><a href="#fn:fn-1">1</a></sup>可知，Hugo 的 RSS 模板搜索顺序如下：</p>

<pre><code class="language-nil">[layouts/index.rss.xml
layouts/home.rss.xml
layouts/rss.xml
layouts/list.rss.xml
layouts/index.xml
layouts/home.xml
layouts/list.xml
layouts/_default/index.rss.xml
layouts/_default/home.rss.xml
layouts/_default/rss.xml
layouts/_default/list.rss.xml
layouts/_default/index.xml
layouts/_default/home.xml
layouts/_default/list.xml
layouts/_internal/_default/rss.xml]
</code></pre>

<p>我们随便按照顺序建立一个 xml 模板文件即可，例如，我们这里建立
<code>layouts/index.rss.xml</code> 文件，使用 Hugo 官方提供的 RSS 模板：</p>

<pre><code class="language-html">{{ printf &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;utf-8\&quot; standalone=\&quot;yes\&quot; ?&gt;&quot; | safeHTML }}
&lt;rss version=&quot;2.0&quot; xmlns:atom=&quot;http://www.w3.org/2005/Atom&quot;&gt;
  &lt;channel&gt;
    &lt;title&gt;{{ if eq  .Title  .Site.Title }}{{ .Site.Title }}{{ else }}{{ with .Title }}{{.}} on {{ end }}{{ .Site.Title }}{{ end }}&lt;/title&gt;
    &lt;link&gt;{{ .Permalink }}&lt;/link&gt;
    &lt;description&gt;Recent content {{ if ne  .Title  .Site.Title }}{{ with .Title }}in {{.}} {{ end }}{{ end }}on {{ .Site.Title }}&lt;/description&gt;
    &lt;generator&gt;Hugo -- gohugo.io&lt;/generator&gt;{{ with .Site.LanguageCode }}
    &lt;language&gt;{{.}}&lt;/language&gt;{{end}}{{ with .Site.Author.email }}
    &lt;managingEditor&gt;{{.}}{{ with $.Site.Author.name }} ({{.}}){{end}}&lt;/managingEditor&gt;{{end}}{{ with .Site.Author.email }}
    &lt;webMaster&gt;{{.}}{{ with $.Site.Author.name }} ({{.}}){{end}}&lt;/webMaster&gt;{{end}}{{ with .Site.Copyright }}
    &lt;copyright&gt;{{.}}&lt;/copyright&gt;{{end}}{{ if not .Date.IsZero }}
    &lt;lastBuildDate&gt;{{ .Date.Format &quot;Mon, 02 Jan 2006 15:04:05 -0700&quot; | safeHTML }}&lt;/lastBuildDate&gt;{{ end }}
    {{ with .OutputFormats.Get &quot;RSS&quot; }}
        {{ printf &quot;&lt;atom:link href=%q rel=\&quot;self\&quot; type=%q /&gt;&quot; .Permalink .MediaType | safeHTML }}
    {{ end }}
    {{ range .Pages }}
    &lt;item&gt;
      &lt;title&gt;{{ .Title }}&lt;/title&gt;
      &lt;link&gt;{{ .Permalink }}&lt;/link&gt;
      &lt;pubDate&gt;{{ .Date.Format &quot;Mon, 02 Jan 2006 15:04:05 -0700&quot; | safeHTML }}&lt;/pubDate&gt;
      {{ with .Site.Author.email }}&lt;author&gt;{{.}}{{ with $.Site.Author.name }} ({{.}}){{end}}&lt;/author&gt;{{end}}
      &lt;guid&gt;{{ .Permalink }}&lt;/guid&gt;
      &lt;description&gt;{{ .Summary | html }}&lt;/description&gt;
    &lt;/item&gt;
    {{ end }}
  &lt;/channel&gt;
&lt;/rss&gt;
</code></pre>

<p>其中，我们需要全局输出，只需要修改 <code>&lt;description&gt;{{ .Summary | html
}}&lt;/description&gt;</code> 为 <code>&lt;description&gt;{{ .Content | html }}&lt;/description&gt;</code> 即可。</p>

<p><code>config.toml</code> 配置中的一些字段可以用来控制 RSS 的输出：</p>

<pre><code class="language-toml">rssLimit = 10  # 限制 RSS 文章输出的数量
languageCode = &quot;en-us&quot;
copyright = &quot;This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.&quot;

[author]
    name = &quot;My Name Here&quot;
</code></pre>

<p>最开始的时候生成 RSS 会抛出一些异常：</p>

<pre><code class="language-language"> error on line 455 at column 40: PCDATA invalid Char value 8
</code></pre>

<p>一般来说，出现这些问题是因为 Markdown 文件中存在一些特殊字符，例如 <code>^H</code>、<code>^E</code> 等字符，解决办法有两个：</p>

<ol>
<li>通过 Hugo 的正则表达式替换掉特殊字符，参考文档<sup class="footnote-ref" id="fnref:fn-2"><a href="#fn:fn-2">2</a></sup></li>
<li>在 markdown 源文件中把特殊字符删除</li>
</ol>

<p>另外，可以通过这个链接来订阅本博客：<a href="http://blog.jiayuanzhang.com/index.xml">http://blog.jiayuanzhang.com/index.xml</a></p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:fn-1"><a href="https://gohugo.io/templates/rss/">https://gohugo.io/templates/rss/</a>
 <a class="footnote-return" href="#fnref:fn-1"><sup>[return]</sup></a></li>
<li id="fn:fn-2"><a href="https://gohugo.io/functions/replacere/#readout">https://gohugo.io/functions/replacere/#readout</a>
 <a class="footnote-return" href="#fnref:fn-2"><sup>[return]</sup></a></li>
</ol>
</div>
  </div>
</div>

<h2>Comments</h2>
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "tisogasnotes" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-130256365-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </body>
</html>
